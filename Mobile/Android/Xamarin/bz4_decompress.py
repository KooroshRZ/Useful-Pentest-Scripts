# credits
# https://github.com/securitygrind/lz4_decompress/blob/main/lz4_decompress.py

import lz4.block, struct
from Crypto.Util.number import bytes_to_long

file = ''

with open(file, 'rb') as o:
    payload = o.read()
    o.close()


magic_header = payload[:4]
header_index = payload[4:8]
payload_length = payload[8:12]
compressed_payload = payload[12:]

print(magic_header)
print(header_index)
print(bytes_to_long(payload_length))


unpacked_payload_len = struct.unpack('<I', payload_length)[0]
print(unpacked_payload_len)

decompressed_payload = lz4.block.decompress(compressed_payload, uncompressed_size=unpacked_payload_len)

outfile = 'out.dll'

with open(outfile, 'wb') as o:
    o.write(decompressed_payload)
    o.close()
